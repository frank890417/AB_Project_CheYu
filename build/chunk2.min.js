function setup(){pixelDensity(2),createCanvas(DIM,DIM),mainGraphics=createGraphics(width,height),fullCanvasTexture=createGraphics(width,height),mainGraphics.scale(DIM/DEFAULT_SIZE),fullCanvasTexture.scale(DIM/DEFAULT_SIZE),width=DEFAULT_SIZE,height=DEFAULT_SIZE;let e=120;for(let t=0;t<=width+1200;t+=e)for(let a=0;a<=height+1200;a+=e)fullCanvasTexture.image(canvasTexture,t,a,e,e);background(100),ang=R.random_num(-.5,.5),mainGraphics.fill(0),mainGraphics.rect(0,0,width,height),overAllTexture=createGraphics(width,height),overAllTexture.loadPixels();for(var t=0;t<width+50;t++)for(var a=0;a<height+50;a++)overAllTexture.set(t,a,color(200,noise(t/10,t*a/300)*R.random_choice([0,0,20,100])));overAllTexture.updatePixels(),translate(width/2,height/2),rotate(ang),translate(-width/2,-height/2),"Rect"==useDivisionType&&div(0,0,width,height,int(R.random_num(2,4))),"Ang"==useDivisionType&&divAng(0,width,0,2*PI,int(R.random_num(2,5))),features.AreaCount=areas.length;for(t=0;t<useParticleCount;t++){let e,a=R.random_choice(useColorSet),r=createVector(useStartPosition[0]*width,useStartPosition[1]*height),i=R.random_num(0,useParticleSize)*R.random_num(.05,1)+1;"Random"==useEmitType?e=createVector(0,1).rotate(R.random_num(0,2*PI)).mult(R.random_num(2,6)):"Even"==useEmitType?(e=createVector(0,1).rotate(map(t,0,useParticleCount,0,PI)).mult(R.random_num(2,6)),i=10*sin(t/4)+12):"LinearHorzontal"==useEmitType?(e=createVector(0,1).rotate(sin(t/useParticleCount*2*PI)).mult(R.random_num(2,6)),r=createVector(map(t,0,useParticleCount,0,width),height/2)):"LinearVertical"==useEmitType?(e=createVector(1,0).rotate(sin(t/useParticleCount*2*PI)).mult(R.random_num(2,6)),r=createVector(width/2,map(t,0,useParticleCount,0,height))):"LinearSlope"==useEmitType&&(e=createVector(1,0).rotate(sin(t/useParticleCount*2*PI)).mult(R.random_num(2,6)),r=createVector(map(t,0,useParticleCount,0,width),map(t,0,useParticleCount,0,height))),particles.push(new Particle({p:r,v:e,r:i,color:a}))}mainGraphics.translate(width/2,height/2),mainGraphics.rotate(ang),mainGraphics.translate(-width/2,-height/2)}function draw(){if(mainGraphics.noStroke(),particles.forEach((e=>{e.update(),areas.forEach((t=>{if(t.isParticleInArea(e)&&e.area!==t&&(e.area=t,e.color=R.random_choice(t.colors),e.v.rotate(R.random_num(-1,1)),R.random_dec()<.1&&e.generation<2&&e.canGenCount>0)){let t=new Particle({p:e.p.copy(),v:e.v.copy(),a:e.a.copy(),generation:e.generation+1});e.canGenCount--,particles.push(t)}})),e.draw()})),particles=particles.filter((e=>e.life>0)),image(mainGraphics,0,0),showCanvasTexture&&(push(),blendMode(MULTIPLY),image(fullCanvasTexture,0,0),pop()),showHash){fill(0),textSize(20),textFont("Courier"),textAlign(RIGHT);for(var e=0;e<tokenData.hash.length;e++){let t=15*e+30,a=height-30;areas.forEach((e=>{if(e.isParticleInArea({p:createVector(t,a)})){let t=color(e.color);.2126*t._getRed()+.7152*t._getGreen()+.0722*t._getBlue()>127.5?fill(0):fill(255)}})),noStroke(),text(tokenData.hash[e],t,a)}}}let showHash=!1;function keyPressed(){"s"==key&&save("CYW_Electriz - "+tokenData.hash+".png"),"t"==key&&(showCanvasTexture=!showCanvasTexture)," "==key&&(showHash=!showHash)}function doubleClicked(){showCanvasTexture=!showCanvasTexture}
